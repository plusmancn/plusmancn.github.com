---
title: '剖析 JS 内 0.1 + 0.2 = 0.30000000000000004 计算失精问题'
date: '2017-05-01 22:35:38'
tags:
- '基石'
---

## 简述
这是一个典型的浮点数失精问题，无论语言，只要采用了 [IEEE-754][l2] 的浮点数标准，都会出现这个问题，有人还为此专门做了一个名为  [0.30000000000000004.com][l1] 的网站来罗列各种语言的的输出结果，下面将分析 `01 + 0.2` 的浮点数运算过程，并讨论浮点数失精的应对方案。

## 十进制转二进制
计算机内部进行浮点数运算时，是以二进制的形式的进行的，所以我们需要先把十进制转成二进制。

以 `4.375` 为例子，整数部分依照除二取余法，转换为二进制，例如
```
4 / 2 =  2..0
2 / 2 =  1..0
4 => 100.
```
小数部分的转换规则为，[对小数部分不停乘 `2`，顺序取个位值，直到乘积为 `1.0`][l3]，例如
```
0.375 * 2 = 0.75
0.75 * 2 = 1.5
0.5 * 2 = 1.0
0.375 => 011
```
前后的计算值合并，则 `4.375` 的二进制表示为 `100.011`

```
0.1
```

[l1]: http://0.30000000000000004.com "0.30000000000000004.com"
[l2]: https://www.csee.umbc.edu/~tsimo1/CMSC455/IEEE-754-2008.pdf "IEEE-754-2008.pdf"
[l3]: http://stackoverflow.com/a/3954640/1914450 "convert float number to binary"
